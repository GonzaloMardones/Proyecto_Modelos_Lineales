---
title: "Proyecto Modelos Lineales"
author: "Oscar Gamboa, Gonzalo Mardones, Nicolas Montecinos"
date: "`r Sys.Date()`"
output: pdf_document
header-includes: 
  - \usepackage{tikz}
  - \usepackage{pgfplots}
  - \usepackage{amsmath}
  - \usepackage{dutchcal}
---





## Introducción

En la actualidad, los servicios públicos han sido objeto de denuncias por parte de la ciudadanía por los temas que competen a las licencias médicas presentadas por los funcionarios de dichas entidades, en ella destacan principalmente las áreas correspondientes a la educación pública y en específico direccionados a los DOCENTES. La ley N° 20.585 de 2012, emitida por el Ministerio de Salud, básicamente indica que la institución estatal se encarga de la tramitación y pago completo de esta, ya sea FONASA o ISAPRE, en desmedro de dejar sin pagos salariales para sus DOCENTES, sin embargo, esto tiende a generar controversia por la gran cantidad de licencias tipo 1 (correspondiente a las psiquiátricas, estrés laboral, medicina general, accidente de trayecto, accidente de trabajo y enfermedad profesional) y el acumulado de días ausentes emitidas por este grupo, ya que indica un problema a los servicios públicos, estos son: búsqueda de reemplazos (por lo general no son docentes debido a la poca oferta que hay hoy en día impactando directamente en la calidad de educación), mayor inversión en la acciones preventivas (mutuales y capacitaciones anti estrés, generando aumentos de presupuestos en las arcas fiscales), uso y abuso de las mismas (compras de licencias médicas que corresponden a un delito), y agotamiento del sistema público.

En el presente proyecto, se direccionará en tratar de explicar el número promedio de días de licencias médicas en Docentes de un servicio local de educación pública de la provincia del Huasco (comunas que comprende: Alto del Carmen, Vallenar, Freirina y Huasco) de la Región de Atacama, en función a características propias de ellos junto a variables relevantes a la demografía y a las educacionales, con el fin de tener una primera mirada ante la problemática ya expuesta, que aporten en gran medida a la toma de decisiones por parte de los establecimientos educacionales estatales. 


### Planteamiento del Problema


Dado los antecedentes ya presentados en el acápite anterior, se quiere determinar si el número promedio de días de las licencias médicas (aprobadas) emitidas por los docentes, de enero a octubre del año 2022, puede ser explicado o influido por fenómenos endógenos como la evaluación docente o el tramo docente (para mayor información hacer click en el siguiente  [link](https://www.docentemas.cl/conozca-la-evaluacion-docente/evaluacion-docente-y-carrera-docente/)) o por variables exógenas (factores ajenos al DOCENTE) como podría ser el traslado de comuna para ir a su lugar de trabajo, al grupo etario al cual pertenece o si es profesor(a) jefe de un curso (debido a que tiene mayor responsabilidad administrativa) etc. Y en caso de ser significativo el efecto ante cambios en los días promedios de licencias médicas, cual es la magnitud y característica de estas variables.

### Justificación del Problema

Se desea identificar los fenómenos que estén, de alguna manera, relacionada con la emisión de licencias médicas para poder direccionar recursos necesarios, realizar cambios correspondientes y anticipar los problemas que generan las ausencias que puedan afectar la calidad de la educación pública bajo la administración de un servicio local en la provincia del Huasco, Región de Atacama, Chile.
  
\newpage

###  Estado del Arte

En la actualidad, la problemática descrita anteriormente se ve reflejada tanto en la comunidad docente (ver [enlace](https://www.colegiodeprofesores.cl/2022/06/08/reemplazos-de-docentes-por-licencias-medicas-orientaciones-al-respecto/) ) como en la ciudadania (ver [enlace](https://www.theclinic.cl/2022/09/14/la-pesadilla-que-atrapa-a-los-profesores/)) y (ver [enlace](https://www.soychile.cl/antofagasta/sociedad/2022/06/26/763718/licencias-medicas-deficit-profesionales-educacion.html)) 


### Objetivos 

- Objetivo General
 
Se busca explicar la cantidad de días promedios de Licencias Médicas de los docentes contratados, bajo la administración del Servicio de Educación Pública de la provincia del Huasco, con información actualizada entre ENERO a OCTUBRE del 2022, considerando variables exógenas y endógenas del Docente, con el fin poder entregar mayores antecedentes a la hora de tomar decisiones a nivel provincial.
  
- Objetivos Específicos
  
   1.- Definir, obtener, extraer y limpiar los datos que corresponden a las caracteristicas que más se relacionen y que aporten al posible efecto de los días en promedio de licencias médicas en docentes de la provincia en el periodo mencionado.

   2.- Descripción uni y bi variada junto a un analisis de asociación de variables predictoras con respecto a la cantidad promedio de días por licencias médicas, para la toma de decisiones respecto a la base de datos a tratar.
    
   3.- Validación de la base de datos,  modificación de su estructura (en caso de ser necesario) y presentación del modelo completo ante las variables escojidas.
   
   4.- Exhibición del modelo escojido, bajo la metodología de selección de variables (Forward y Backward)


### Plateamiento de la hipótesis en el estudio

Se requiere determinar lo siguiente: ¿Que tan cierto es que a mayor evaluación docente y tramo docente (variables endógenas), menor es la cantidad de días de solicitadas por licencias médicas?, y si lo hay, ¿De cuanto es lo que impacta en promedio a los días tomados por licencias medicas tipo 1?

¿Existen variables exógenas que tienen un impacto en los días promedios tomados por las licencias médicas?, si es así, ¿De cuanto es lo que explica este fenómeno?


## Generación de unidades de información

Las unidades de información hace referencia a la dotación de Docentes en la provincia del Huasco que han presentado licencias médicas en el periodo de enero a octubre 2022, que se encuentran bajo la administracion del Servicio Local de Educación Pública del Huasco, Región de Atacama, Chile. Por lo tanto se tiene lo siguiente:

- Total de docentes en la provincia: 1.109.

- Cantidad de Establecimientos Educacionales: 53.

- Total de docentes que han presentado licencias medicás tipo 1: 657

Para fines de este estudio, se determina una muestra aleatoria de 500 docentes que presentaron licencias médicas tipo 1, bajo la reglamentación impuesta por la entidad evaluadora.

Finalmente se obtienen los siguientes antecedentes de acuerdo a los días promedios de licencias médicas emitidas por docentes de la provincia del Huasco:

```{r fig.align="center", warning=FALSE, message=FALSE, out.width="70%", include = FALSE}

library(readxl)
library(tidyverse)
library(dplyr)
library(knitr)
library(ggplot2)
library(scales)
library(cowplot)
library(PerformanceAnalytics)
library(patchwork)
library(hrbrthemes)
library(viridis)

#General Settings
color_fill_histogram <- "lightblue"
color_contours_histogram <-"black"

color_fill_bar <- "steelblue"
color_contours_bar <- "black"

# Lectura y cambio de estructura de la BBDD

setwd("~/Desktop/MAGISTER/modelos_lineales/")
BBDD_proyecto <- read_excel("BBDD_FINAL_Mod_Lin.xlsx")
BBDD_proyecto <- BBDD_proyecto %>% mutate_at(c("SEXO","ESTADO_CIVIL",
                                               "SISTEMA_SALUD","NIVEL",
                                               "TIPO_ESTABLECIMIENTO",
                                               "CALIDAD_DESEMPEÑO",
                                               "COMUNA_ESTABLECIMIENTO",
                                               "ESTAMENTO","TRAMO_DOCENTE", "TRASLADO_COMUNA"),factor)

BBDD_proyecto$TRASLADO_COMUNA<-factor(BBDD_proyecto$TRASLADO_COMUNA, levels = c(0,1), labels = c("No", "Si"))


BBDD_proyecto$EVALUACION_DOCENTE <- factor(BBDD_proyecto$EVALUACION_DOCENTE,
                                           levels = c("SIN EVALUACIÓN",
                                                      "DESTACADO",
                                                      "BASICO",
                                                      "INSATISFACTORIO",
                                                      "COMPETENTE"))


BBDD_proyecto_sin_ceros_ <- BBDD_proyecto %>% filter(PROMEDIO_DIAS_LM != 0)

# Seleccion de muestra aleatoria de tamaño 500

n <- dim(BBDD_proyecto_sin_ceros_)[1]
set.seed(20221012)
id_sample <- sample(1:n,500, replace=F)
BBDD_proyecto_sin_ceros <- BBDD_proyecto_sin_ceros_[id_sample,]

```

|Cant. Docentes | Min.| 1st Qu.| Mediana | Promedio | 3rd Qu. | Max. |
|:---------:|:---------:|:---------:|:---------:|:---------:|:---------:|:---------:|
|500| 1.00 | 5.00 | 7.00 | 10.44 | 14.85 | 30.00 | 

```{r fig.align="center", warning=FALSE, message=FALSE, echo=FALSE,out.width="80%", out.height="100%", echo = FALSE}

library(ggplot2)
# Gráficos de distribución y boxplot.

p1 <- ggplot(BBDD_proyecto_sin_ceros, aes(x = PROMEDIO_DIAS_LM)) +
  geom_histogram(aes(y =..density..), colour = "black", fill = "white") +
  geom_density(alpha = 0.6 , fill = "#FF6666", lwd = 1,colour = 2)+
  geom_vline(aes(xintercept = mean(PROMEDIO_DIAS_LM)),
             color = "blue", linetype = "dashed", size = 1)+
  theme_minimal()+
  ggtitle("Distribución de \n Licencias Médicas") +
  ggeasy::easy_center_title()+
  labs(
    title="Distribución de Licencias Médicas",
    # subtitle = "Cantidad de DOCENTES: 500",
    y="Densidad",
    x="Días Promedios",
    caption = "Elab. propia: BBDD - lic. med. 2022"
  )+
  theme(plot.title = element_text(size = rel(1)))



p2<-ggplot(BBDD_proyecto_sin_ceros, aes(y = PROMEDIO_DIAS_LM)) +
  geom_boxplot(fill = "#FF6666" )+
  ggtitle("Box-plot del promedio de \n días por lic. Médicas") +
  ggeasy::easy_center_title()+
  
  labs(
    y = "Cantidad promedio de días",
    caption = "Elab. propia: BBDD - lic. med. 2022"
  )+
  theme(plot.title = element_text(size = rel(1)))+
  theme_minimal()+
  scale_fill_brewer(palette = "Set2")



cowplot::plot_grid(p1,p2)

```

Se observa que el promedio de días se aproxima a una distribución asimétrica negativa, lo que indica...


### Diseño de estrategias metodológicas
<!-- : ¿Qué metodologías utilizaré?; -->
<!-- ¿Cómo voy a alcanzar los objetivos que he construido? -->

Para el presente proyecto, se plantea metodología a través de regresiones lineales, dando principal enfásis al análisis descriptivo y en el tratamiento de la estructura de la base de datos, tomando decisiones de esta ante una postura de recodificación de variable si es posible dado el caso.

### Estructura de la base de datos 

\begin{center}
    \begin{tabular}{|c|}
        \hline
        \textbf{Base de datos de Licencias Médicas}\\
        \begin{tabular}{|p{5cm}|p{1cm}|p{9cm}|}
            \hline
             \textbf{Variable} & \textbf{Tipo} & \textbf{Descripción}\\
             \hline
             SEXO & Factor & Masculino y Femenino\\
            \hline
             ESTADO\_CIVIL & Factor & Casado(a), Viudo(a), Soltero(a), Divorciado(a) \\
            \hline
             EDAD & Double & Edad\\
            \hline
             RENTA\_PROMEDIO & Double & Renta Promedio en Pesos Chilenos\\
            \hline
             SISTEMA\_SALUD & Factor & Fonasa, Isapre\\
            \hline 
             JORNADA & Double & Mediadas en horas semanales\\
            \hline             
             NIVEL & Factor & Básica o Media\\
            \hline                         
             TIPO\_ESTABLECIMIENTO & Factor & Escuela o Liceo\\
            \hline                                    
             CALIDAD\_DESEMPEÑO & Factor & Profesor Titular o no\\
            \hline  
             TRAMO\_DOCENTE & Factor & Inicial, Temprano, Acceso, Avanzado, Experto I, Experto II, Sin Encasillamiento \\
            \hline                          
             EVALUACION\_DOCENTE & Factor & Sin Evaluación, Destacado, Básico, Insatisfactorio, Competente\\
            \hline  
             PROMEDIO\_DIAS\_LM & Double & Promedio Días de Licencias Médicas\\
            \hline                          
             TRASLADO\_COMUNA & Double & SI (1) o NO (0)\\
            \hline                  
        \end{tabular}\\
        \\
        \hline
    \end{tabular}
\end{center}

## Análisis Descriptivo

Para el siguiente paso, se definirán las variables a las cuales las llamaremos Exógenas y Endogenas, indicando sus principales indicadores según los días promedios de licencias médicas cursadas.

```{r fig.align="center", warning=FALSE, message=FALSE, out.width="70%", include = FALSE}

tabla_1 <- BBDD_proyecto_sin_ceros %>% 
  group_by(EVALUACION_DOCENTE) %>% 
  summarise(Promedio = mean(PROMEDIO_DIAS_LM),
            Mediana = median(PROMEDIO_DIAS_LM),
            DesvEstandar = sd(PROMEDIO_DIAS_LM),
            Mín = min(PROMEDIO_DIAS_LM),
            Máx = max(PROMEDIO_DIAS_LM),
            Cantidad = sum(CANTIDAD_LM))
```

**a.-** **Variables Endógenas** (indicadores de evaluaciones propias del docentes)

- El Sistema de Evaluación del Desempeño Profesional Docente (o Evaluación Docente) es una evaluación obligatoria para los y las docentes, educadoras y educadores de aula que se desempeñan en establecimientos municipales o estatales a lo largo del país. Su objetivo es fortalecer la profesión docente y contribuir a mejorar la calidad de la educación.[^1] 

[^1]: Evaluación Docente, para mayor información visite [www.cpeip.cl](https://www.cpeip.cl/carrera-docente-progresion-tramos/#:~:text=Tramo%20voluntario%20que%20da%20cuenta,de%20acompa%C3%B1amiento%20y%20liderazgo%20pedag%C3%B3gico.)


```{r, message=FALSE, warning=FALSE, echo = FALSE,fig.align="center", echo=FALSE}

tabla_endogena_1 <- BBDD_proyecto_sin_ceros %>% 
  group_by(EVALUACION_DOCENTE) %>% 
  summarise(Promedio = mean(PROMEDIO_DIAS_LM),
            Mediana = median(PROMEDIO_DIAS_LM),
            DesvEstandar = sd(PROMEDIO_DIAS_LM),
            Mín = min(PROMEDIO_DIAS_LM),
            Máx = max(PROMEDIO_DIAS_LM),
            Cantidad_LM = sum(CANTIDAD_LM))

knitr::kable(tabla_endogena_1, align = c("l","c","c","c","c","c","c"), caption = "Evaluación Docente")




ggplot(data=BBDD_proyecto_sin_ceros, aes(x=EVALUACION_DOCENTE, y=PROMEDIO_DIAS_LM, 
                                         fill = EVALUACION_DOCENTE))+
  geom_boxplot() +
  labs(
    title="Distribución de los días promedio según la Evaluación Docente",
    caption = "Elab. propia: BBDD Lic. Médicas 2022",
    subtitle = "Cantidad de Docentes = 500",
    y="Cantidad de Días promedios",
    x="Evaluación Docente"
  )+
  theme_minimal()+
  scale_fill_brewer(palette = "Set2")+
  theme(legend.position="none")
```

Al observar cada evaluación se aprecia que la categoría Insatisfactorio resalta de las demas por poseer una media y mediana mayor en comparación a las demás categorías de evaluación, por consiguiente, el gráfico de boxplot ratifica lo mencionado e indica que tiene un rango de variación distinto en comparación,sin embargo, las demás categórias de evaluación poseen similares distribuciones al apreciar sus indicadores.


- La Carrera Docente cuenta con cinco tramos en que los profesores pueden progresar demostrando las competencias y conocimientos alcanzados. Además, existe un tramo provisorio, denominado Acceso, para aquellos docentes que tienen más de cuatro años de experiencia, pero que no cuentan con resultados en evaluaciones previas del Ministerio de Educación.[^2]

[^2]: Tramo Docente, para mayor información visite [www.docentemas.cl](https://www.docentemas.cl/quienes-somos/que-es-la-evaluacion-docente/)


```{r, message=FALSE, warning=FALSE, echo = FALSE,fig.align="center", echo=FALSE}
tabla_endogena_2 <- BBDD_proyecto_sin_ceros %>% 
  group_by(TRAMO_DOCENTE) %>% 
  summarise(Promedio = mean(PROMEDIO_DIAS_LM),
            Mediana = median(PROMEDIO_DIAS_LM),
            DesvEstandar = sd(PROMEDIO_DIAS_LM),
            Mín = min(PROMEDIO_DIAS_LM),
            Máx = max(PROMEDIO_DIAS_LM),
            Cantidad_LM = sum(CANTIDAD_LM))

knitr::kable(tabla_endogena_2, align = c("l","c","c","c","c","c","c"), caption = "Tramo Docente")

# Boxplot evaluación docente vs dias promedio.

ggplot(data=BBDD_proyecto_sin_ceros, aes(x=TRAMO_DOCENTE, y=PROMEDIO_DIAS_LM, 
                                         fill = TRAMO_DOCENTE))+
  geom_boxplot() +
  labs(
    title="Distribución de los días promedio según la Tramo Docente",
    caption = "Elab. propia: BBDD Lic. Médicas 2022",
    y="Cantidad de Días promedios",
    x="Tramo Docente"
  )+
  theme_minimal()+
  theme(text = element_text(size=7))+
  theme(axis.title.x = element_text(vjust=-0.5, size=rel(1.5))) +
  theme(axis.title.y = element_text(vjust=1.5, size=rel(1.5))) +
  theme(plot.title = element_text(size = rel(2)))+
  scale_fill_brewer(palette = "Set2")+
  theme(legend.position="none")
```


Se instuye que a diferencia de los demás tramos, el EXPERTO II no presenta un rango de variabilidad que la caracterice, por otro lado, la categoría que más se destaca, en términos de sus indicadores, es aquel tramo donde no presenta encasillamiento, pero esto se puede deber a un efecto producido por la cantidad de licencias presentadas de tal tramo. Además es interesante indica que el TRAMO INICIAL y el TEMPRANO poseen la mayor cantidad de licencias medicas liderando así, tanto en media como en mediana este último mencionado respectivamente. Finalmente, y descartando la categoría EXPERTO II, al parecer y en base a un criterio gráfico, todas los tramos poseen un similar comportamiento en funcion a los días promedios por licencias medicas emitidas.


A modo de conclusión de este análisis, se toma la decisión de recodificar la variable EVALUACIÓN DOCENTE, en una nueva variable la que se llamará INSATISFACTORIO, quedando los siguiente indicadores junto con su distribución:

```{r include=FALSE}
# Recodificación Insatisfactorio.

BBDD_proyecto_sin_ceros %>% mutate(INSATISFACTORIO = EVALUACION_DOCENTE)
BBDD_proyecto_sin_ceros$INSATISFACTORIO <- ifelse(BBDD_proyecto_sin_ceros$EVALUACION_DOCENTE == "INSATISFACTORIO", 1, 0)
BBDD_proyecto_sin_ceros$INSATISFACTORIO <- factor(BBDD_proyecto_sin_ceros$INSATISFACTORIO,
                                                  levels = c(0,1),
                                                  labels = c("No Insatisfactorio","Insatisfactorio"))
```


```{r, message=FALSE, warning=FALSE, echo = FALSE,fig.align="center", echo=FALSE}

tabla_endogena_3 <- BBDD_proyecto_sin_ceros %>% 
  group_by(INSATISFACTORIO) %>% 
  summarise(Promedio = mean(PROMEDIO_DIAS_LM),
            Mediana = median(PROMEDIO_DIAS_LM),
            DesvEstandar = sd(PROMEDIO_DIAS_LM),
            Mín = min(PROMEDIO_DIAS_LM),
            Máx = max(PROMEDIO_DIAS_LM),
            Cantidad_LM = sum(CANTIDAD_LM))

knitr::kable(tabla_endogena_3, align = c("l","c","c","c","c","c","c"), caption = "Insatisfactorio")

ggplot(data=BBDD_proyecto_sin_ceros, aes(x=INSATISFACTORIO, y=PROMEDIO_DIAS_LM, 
                                         fill = INSATISFACTORIO))+
  geom_boxplot() +
  labs(
    title="Distribución de los días promedio según variable Insatisfactorio",
    caption = "Elab. propia: BBDD Lic. Médicas 2022",
    subtitle = "Cantidad de Docentes = 500",
    y="Cantidad de Días promedios",
    x="Insatisfactorio"
  )+
  theme_minimal()+
  scale_fill_brewer(palette = "Set2")+
  theme(legend.position="none")

```


**b.-** **Variables Exógenas**  (indicadores ajenas al docentes)

En esta presente sección, se analizaran las variables que son ajenas a las capacidades evaluativas propias del docentes dado el número promedio de días por licencia médica emitida, las cuales son:

```{r, message=FALSE, warning=FALSE, echo = FALSE,fig.align="center", echo=FALSE,out.width="70%"}

# Análisis descriptivo de las variables exógenas.

# SEXO
tabla_exogena_1<- BBDD_proyecto_sin_ceros %>% 
  group_by(SEXO) %>% 
  summarise(n = n(),
            Promedio = mean(PROMEDIO_DIAS_LM),
            Mediana = median(PROMEDIO_DIAS_LM),
            DesvEstandar = sd(PROMEDIO_DIAS_LM),
            Mín = min(PROMEDIO_DIAS_LM),
            Máx = max(PROMEDIO_DIAS_LM),
            Cantidad_LM = sum(CANTIDAD_LM))

ggplot(data=BBDD_proyecto_sin_ceros, aes(x=SEXO, y=PROMEDIO_DIAS_LM, fill = SEXO)) +
  geom_boxplot() +
  labs(
    title="Distribución de los días promedio según Sexo",
    caption = "Elab. propia: BBDD Lic. Médicas 2022",
    y="Cantidad de Días promedios",
    x="Sexo"
  )+
  theme_minimal()+
  scale_fill_brewer(palette = "Set2")+
  theme(legend.position="none")

# ESTADO CIVIL

tabla_exogena_2<- BBDD_proyecto_sin_ceros %>% 
  group_by(ESTADO_CIVIL) %>% 
  summarise(n = n(),
            Promedio = mean(PROMEDIO_DIAS_LM),
            Mediana = median(PROMEDIO_DIAS_LM),
            DesvEstandar = sd(PROMEDIO_DIAS_LM),
            Mín = min(PROMEDIO_DIAS_LM),
            Máx = max(PROMEDIO_DIAS_LM),
            Cantidad_LM = sum(CANTIDAD_LM))

ggplot(data=BBDD_proyecto_sin_ceros, aes(x=ESTADO_CIVIL, y=PROMEDIO_DIAS_LM, fill = ESTADO_CIVIL)) +
  geom_boxplot() +
  labs(
    title="Distribución de los días promedio según Estado Civil",
    caption = "Elab. propia: BBDD Lic. Médicas 2022",
    y="Cantidad de Días promedios",
    x="Estado Civil"
  )+
  theme_minimal()+
  scale_fill_brewer(palette = "Set2")+
  theme(legend.position="none")


#SISTEMA DE SALUD

tabla_exogena_3<- BBDD_proyecto_sin_ceros %>% 
  group_by(SISTEMA_SALUD) %>% 
  summarise(n = n(),
            Promedio = mean(PROMEDIO_DIAS_LM),
            Mediana = median(PROMEDIO_DIAS_LM),
            DesvEstandar = sd(PROMEDIO_DIAS_LM),
            Mín = min(PROMEDIO_DIAS_LM),
            Máx = max(PROMEDIO_DIAS_LM),
            Cantidad_LM = sum(CANTIDAD_LM))

ggplot(data=BBDD_proyecto_sin_ceros, aes(x=SISTEMA_SALUD, y=PROMEDIO_DIAS_LM, fill = SISTEMA_SALUD)) +
  geom_boxplot() +
  labs(
    title="Distribución de los días promedio según Sistema de Salud",
    caption = "Elab. propia: BBDD Lic. Médicas 2022",
    y="Cantidad de Días promedios",
    x="Sistema de Salud"
  )+
  theme_minimal()+
  scale_fill_brewer(palette = "Set2")+
  theme(legend.position="none")

#NIVEL

tabla_exogena_4<- BBDD_proyecto_sin_ceros %>% 
  group_by(NIVEL) %>% 
  summarise(n = n(),
            Promedio = mean(PROMEDIO_DIAS_LM),
            Mediana = median(PROMEDIO_DIAS_LM),
            DesvEstandar = sd(PROMEDIO_DIAS_LM),
            Mín = min(PROMEDIO_DIAS_LM),
            Máx = max(PROMEDIO_DIAS_LM),
            Cantidad_LM = sum(CANTIDAD_LM))

ggplot(data=BBDD_proyecto_sin_ceros, aes(x=NIVEL, y=PROMEDIO_DIAS_LM, fill = NIVEL)) +
  geom_boxplot() +
  labs(
    title="Distribución de los días promedio según Nivel",
    caption = "Elab. propia: BBDD Lic. Médicas 2022",
    y="Cantidad de Días promedios",
    x="Nivel"
  )+
  theme_minimal()+
  scale_fill_brewer(palette = "Set2")+
  theme(legend.position="none")

#TIPO DE ESTABLECIMIENTO

tabla_exogena_5<- BBDD_proyecto_sin_ceros %>% 
  group_by(TIPO_ESTABLECIMIENTO) %>% 
  summarise(n= n(),
            Promedio = mean(PROMEDIO_DIAS_LM),
            Mediana = median(PROMEDIO_DIAS_LM),
            DesvEstandar = sd(PROMEDIO_DIAS_LM),
            Mín = min(PROMEDIO_DIAS_LM),
            Máx = max(PROMEDIO_DIAS_LM),
            Cantidad_LM = sum(CANTIDAD_LM))

ggplot(data=BBDD_proyecto_sin_ceros, aes(x=TIPO_ESTABLECIMIENTO, y=PROMEDIO_DIAS_LM, fill = TIPO_ESTABLECIMIENTO)) +
  geom_boxplot() +
  labs(
    title="Distribución de los días promedio Tipo Establecimiento",
    caption = "Elab. propia: BBDD Lic. Médicas 2022",
    y="Cantidad de Días Promedios",
    x="Tipo Establecimiento"
  )+
  theme_minimal()+
  theme(legend.position="none")+
  scale_fill_brewer(palette = "Set2")

# CALIDAD DE DESEMPEÑO

tabla_exogena_6<- BBDD_proyecto_sin_ceros %>% 
  group_by(CALIDAD_DESEMPEÑO) %>% 
  summarise(n = n(),
            Promedio = mean(PROMEDIO_DIAS_LM),
            Mediana = median(PROMEDIO_DIAS_LM),
            DesvEstandar = sd(PROMEDIO_DIAS_LM),
            Mín = min(PROMEDIO_DIAS_LM),
            Máx = max(PROMEDIO_DIAS_LM),
            Cantidad_LM = sum(CANTIDAD_LM))

ggplot(data=BBDD_proyecto_sin_ceros, aes(x=CALIDAD_DESEMPEÑO, y=PROMEDIO_DIAS_LM, fill = CALIDAD_DESEMPEÑO)) +
  geom_boxplot() +
  labs(
    title="Distribución de los días promedio Calidad de Desempeño",
    caption = "Elab. propia: BBDD Lic. Médicas 2022",
    y="Cantidad de Días promedios",
    x="Calidad de Desempeño"
  )+
  theme_minimal()+
  scale_fill_brewer(palette = "Set2")+
  theme(legend.position="none")

# TRASLADO DE COMUNA

tabla_exogena_7<- BBDD_proyecto_sin_ceros %>% 
  group_by(TRASLADO_COMUNA) %>% 
  summarise(n = n(),
            Promedio = mean(PROMEDIO_DIAS_LM),
            Mediana = median(PROMEDIO_DIAS_LM),
            DesvEstandar = sd(PROMEDIO_DIAS_LM),
            Mín = min(PROMEDIO_DIAS_LM),
            Máx = max(PROMEDIO_DIAS_LM),
            Cantidad_LM = sum(CANTIDAD_LM))


ggplot(data=BBDD_proyecto_sin_ceros, aes(x=TRASLADO_COMUNA, y=PROMEDIO_DIAS_LM, fill = TRASLADO_COMUNA)) +
  geom_boxplot() +
  labs(
    title="Distribución de los días promedio por Traslado de Comuna",
    caption = "Elab. propia: BBDD Lic. Médicas 2022",
    y="Cantidad de Días promedios",
    x="Traslado de Comuna"
  )+
  theme_minimal()+
  scale_fill_brewer(palette = "Set2")+
  theme(legend.position="none")


knitr::kable(tabla_exogena_1, align = c("l","r","r","r","r","r","r","r"), caption = "Sexo")

knitr::kable(tabla_exogena_2, align = c("l","r","r","r","r","r","r","r"),
             caption = "Estado Civil")
knitr::kable(tabla_exogena_3, align = c("l","r","r","r","r","r","r","r"),
             caption="Sistema de Salud")
knitr::kable(tabla_exogena_4, align = c("l","r","r","r","r","r","r","r"),
             caption ="Nivel")
knitr::kable(tabla_exogena_5, align = c("l","r","r","r","r","r","r","r"),
             caption = "Tipo Establecimiento" )
knitr::kable(tabla_exogena_6, align = c("l","r","r","r","r","r","r","r"),
             caption = "Calidad Desempeño")
knitr::kable(tabla_exogena_7, align = c("l","r","r","r","r","r","r","r"),
             caption = "Traslado Comuna")
```

















### Distribución de Licencias Médicas




```{r fig.align="center", warning=FALSE, message=FALSE, echo=FALSE,out.width="80%", out.height="100%", include=FALSE}
p1<- ggplot(BBDD_proyecto, aes(x = PROMEDIO_DIAS_LM)) +
  geom_histogram(aes(y =..density..), colour = "black", fill = "white") +
  geom_density(alpha = 0.6 , fill = "#FF6666", lwd = 1,colour = 2)+
  geom_vline(aes(xintercept = mean(PROMEDIO_DIAS_LM)),
             color = "blue", linetype = "dashed", size = 1)+
  theme_minimal()+
  labs(
  title="Distribución de Licencias Médicas",
  subtitle = "Considerando día cero",
  y="Densidad",
  x="Días Promedios",
   caption = "Elaboración Propia"
  )
  

p2<- ggplot(BBDD_proyecto_sin_ceros, aes(x = PROMEDIO_DIAS_LM)) +
  geom_histogram(aes(y =..density..), colour = "black", fill = "white") +
  geom_density(alpha = 0.6 , fill = "#FF6666", lwd = 1,colour = 2)+
  geom_vline(aes(xintercept = mean(PROMEDIO_DIAS_LM)),
             color = "blue", linetype = "dashed", size = 1)+
  theme_minimal()+
  labs(
  title="Distribución de Licencias Médicas",
  subtitle = "Descartando día cero",
  y="Densidad",
  x="Días Promedios",
  caption = "Elaboración Propia"
  )

cowplot::plot_grid(p1,p2)

```

```{r fig.align="center", warning=FALSE, message=FALSE, out.width="80%", out.height="100%", echo=FALSE}
# Variable Sexo
p1<- ggplot(data=BBDD_proyecto_sin_ceros, aes(x=SEXO))+
  geom_bar(color = color_contours_bar, fill = color_fill_bar)+
  scale_y_continuous(limits = c(0,500))+
  geom_text(stat='count', aes(x = SEXO, label = ..count..), vjust = 2, color="white")+
  labs(
    title="Distribución de la variable Sexo",
    y="Frecuencia",
    x="Sexo",
    caption = "Elab. Propia: Fem (74.4%), Masc (25.6%)"
  )+
  theme_minimal()+
  scale_fill_brewer(palette = "Set2")

p2 <-ggplot(data=BBDD_proyecto_sin_ceros, aes(x=EDAD))+
  
  geom_histogram(aes(y =..density..), colour = "black", fill = "white") +
  geom_density(alpha = 0.6 , fill = "#FF6666", lwd = 1,colour = 2)+
  labs(
    title="Distribución de la variable Edad",
    y="Densidad",
    x="Edad",

  )+
  theme_minimal()+
  scale_fill_brewer(palette = "Set2")

cowplot::plot_grid(p1,p2)

```

De acuerdo a los resultados, la variable edad parece tener una distribución bimodal, de hecho, nos da luces de uan cierta mezcla de distribuciones, por lo cual se hace necesario el poder analizar esta variable de acuerdo a variables categóricas como es el sexo.


```{r, message=FALSE, warning=FALSE, echo=FALSE,fig.align="center"}
# bases de datos por sexo
df_final_femenino<- BBDD_proyecto_sin_ceros %>% filter(SEXO=="FEMENINO")
df_final_masculino<- BBDD_proyecto_sin_ceros %>% filter(SEXO=="MASCULINO")

# Edad de Genero femenino
p1<-ggplot(data=df_final_femenino, aes(x=EDAD))+
     geom_histogram(aes(y =..density..), colour = "black", fill = "white") +
     geom_density(alpha = 0.6 , fill = "#FF6666", lwd = 1,colour = 2)+
     labs(
       title="Distribución Sexo Fem",
       y="Densidad",
       x="Edad"
     )+
     theme_minimal()


# Edad de Genero femenino
p2<-ggplot(data=df_final_masculino, aes(x=EDAD))+
     geom_histogram(aes(y =..density..), colour = "black", fill = "white") +
     geom_density(alpha = 0.6 , fill = "#FF6666", lwd = 1,colour = 2)+
     labs(
       title="Distribución Sexo Masc",
       y="Densidad",
       x="Edad"
     )+
     theme_minimal()

# Edad de Genero
p3<- ggplot(BBDD_proyecto_sin_ceros, aes(SEXO, EDAD)) +
  geom_boxplot(aes(fill=SEXO))+
  xlab("Sexo")+
  ylab("Edad")+
  scale_y_continuous(labels = comma)+
  labs(title = "Distribución Renta Promedio",
       # subtitle = "Boxplot por sexo",
       caption = "Elaboración Propia")  +
  labs(fill = "Sexo") +  
  theme(
    legend.position = "none"
  )+
  theme_minimal()+
  scale_fill_brewer(palette = "Set2")
  # geom_jitter(color="black", size=0.3, alpha=0.9)


p3 + (p1/p2)

```

En este sentido, la distribución de edades en mujeres y homnbres es bastante similar, en cada sexo se puede apreciar una distribución bimodal.


|Min.|1st Qu.|Mediana | Promedio | 3rd Qu. | Max. |
|:---------:|:---------:|:---------:|:---------:|:---------:|:---------:|
|$\$705.804$| $\$1.377.071$ | $\$1.609.868$ | $\$1.668.484$ | $\$1.931.119$ | $\$3.420.643$ | 


```{r, message=FALSE, warning=FALSE, echo=FALSE,  out.width="80%", out.height="100%", fig.align="center"}
# summary(BBDD_proyecto_sin_ceros$RENTA_PROMEDIO)

# Renta Promedio
p1<-ggplot(data=BBDD_proyecto_sin_ceros, aes(x=RENTA_PROMEDIO))+
     geom_histogram(aes(y =..density..), colour = "black", fill = "white") +
     geom_density(alpha = 0.6 , fill = "#FF6666", lwd = 1,colour = 2)+
     scale_x_continuous(labels = comma)+
     labs(
       title="Distribución Renta Promedio",
       y="Densidad",
       x="Renta Promedio"
     )+
     theme_minimal()

# Renta Promedio
p2<- 
  ggplot(BBDD_proyecto_sin_ceros, aes(x ="", y = RENTA_PROMEDIO)) +
  geom_boxplot(aes(fill=RENTA_PROMEDIO))+
  xlab("Renta Promedio")+
  ylab("Distribución")+
  scale_y_continuous(labels = comma)+

  labs(title = "Distribución Renta Promedio",
       caption = "Elaboración Propia")  +
  labs(fill = "Renta Promedio") +  
  theme(
    legend.position = "none"
  )+
  theme_minimal()+
  scale_fill_brewer(palette = "Set2")+
  # geom_jitter(color="black", size=0.3, alpha=0.9)


p1 + p2

```

En este caso la distribución de la renta está centrada alrededor de 1,7 millones de pesos, donde el 25% más bajo de la distribución de renta está por debajo de los 1.37 millones, mientras que el 25% de los casos con mayores rentas se encuentran entre 1.93 y 3.42 millones de pesos.


### Femenino

|Min.|1st Qu.|Mediana | Promedio | 3rd Qu. | Max. |
|:---------:|:---------:|:---------:|:---------:|:---------:|:---------:|
|$\$770.197$| $\$1.362.827$ | $\$1.592.526$ | $\$1.652.053$ | $\$1.904.939$ | $\$3.420.643$ |  

### Masculino

|Min.|1st Qu.|Mediana | Promedio | 3rd Qu. | Max. |
|:---------:|:---------:|:---------:|:---------:|:---------:|:---------:|
|$\$705.804$| $\$1.397.245$ | $\$1.626.350$ | $\$1.741.390$ | $\$2.029.702$ | $\$3.233.292$ |



```{r, message=FALSE, warning=FALSE, echo = FALSE,  out.width="80%", out.height="100%", fig.align="center"}
# summary(df_final_femenino$RENTA_PROMEDIO)
# summary(df_final_masculino$RENTA_PROMEDIO)

ggplot(BBDD_proyecto_sin_ceros, aes(SEXO, RENTA_PROMEDIO)) +
  geom_boxplot(aes(fill=SEXO))+
  xlab("SEXO")+
  ylab("Renta Promedio")+
  scale_y_continuous(labels = comma)+
  labs(title = "Distribución por Renta Promedio",
       caption = "Elaboración Propia")  +
  labs(fill = "Sexo") +  
  theme(
    legend.position = "none"
  )+
  theme_minimal()+
  scale_fill_brewer(palette = "Set2")
  # geom_jitter(color="black", size=0.3, alpha=0.9)
```

Comparando los niveles de renta por sexo se puede notar una cierta similitud en el rango de montos promedio, más aún, las estadísticas de posición (cuartiles) son bastante similares, por lo que podría no haber un efecto del sexo sobre los ingresos promedio. Para las mujeres la mediana de las rentas promedio es 1.58 millones, mientras que para los hombre bordea los 1.62 millones de pesos.

```{r, message=FALSE, warning=FALSE,  out.width="80%", out.height="100%",  echo = FALSE, fig.align="center"}
# Sistemas de salud por sexo
ggplot(data=BBDD_proyecto_sin_ceros, aes(x=SEXO, fill=SISTEMA_SALUD))+
  geom_bar(color = "black")+
  geom_text(stat='count', aes(x = SEXO, label = ..count..), vjust = 1.5, color="black")+
  scale_y_continuous(limits = c(0,500))+
  labs(
    title="Distribución de la variable Sistemas de salud",
    y="Frecuencia",
    x="Sistemas de Salud"
  )+
  theme_minimal()+
  scale_fill_brewer(palette = "Set2")

```

Según los datos, la proporción de personas que pertenecen al sistema de salud fonasa es alto tanto en hombres como en mujeres, esto tiene sentido desde el punto de vista que es una base de información de la provincia de Huasco donde existe una alta mayoría de zonas rurales donde el sistema fonasa es predominante.

|Min.|1st Qu.|Mediana | Promedio | 3rd Qu. | Max. |
|:---------:|:---------:|:---------:|:---------:|:---------:|:---------:|
|$22.00$| $44.00$ | $44.00$ | $43.05$ | $44.00$ | $44.00$ |


```{r, message=FALSE, warning=FALSE,  out.width="80%", out.height="100%", echo = FALSE, fig.align="center"}
# summary(BBDD_proyecto_sin_ceros$JORNADA)

# Variable Jornada
ggplot(data=BBDD_proyecto_sin_ceros, aes(x=JORNADA))+
  geom_histogram( color=color_contours_histogram, fill=color_fill_histogram)+
  geom_text(stat='count', aes(x = JORNADA, label = ..count..), vjust = -1 , color="black")+
  # scale_x_continuous(limits = c(15,90))+
  scale_y_continuous(limits = c(0,30))+
  labs(
    title="Distribución de Jornada por Sexo",
    y="Frecuencia",
    x="Sexo"
  )+
  theme_minimal()+
  scale_fill_brewer(palette = "Set2")
```

Podemos notar que prácticamente el 75% de los las personas de la muestra trabajan jornadas de 44 o menos horas semanales, mientras que sólo un caso muestra 88 horas laborales semanales, este caso se debe a ..... (justificar el caso) 




```{r, message=FALSE, warning=FALSE,out.width="80%", out.height="100%", echo = FALSE, fig.align="center"}
# Estado Civil
color_fill_bar_ <- "steelblue"
color_contours_bar_ <- "black"
ggplot(data=BBDD_proyecto_sin_ceros, aes(x=ESTADO_CIVIL))+
  geom_bar(fill= color_fill_bar_, color = color_contours_bar)+
  geom_text(stat='count', aes(x = ESTADO_CIVIL, label = ..count..), vjust = -1)+
  scale_y_continuous(limits = c(0,500))+
  labs(
    title="Distribución de Estado Civil",
    y="Frecuencia",
    x="Estado Civil"
  )+
  theme_minimal()+
  scale_fill_brewer(palette = "Set2")
```

texto


```{r, message=FALSE, warning=FALSE, echo = FALSE,fig.align="center"}
# Evaluación Docente
ggplot(data=BBDD_proyecto_sin_ceros, aes(x=EVALUACION_DOCENTE))+
  geom_bar(color = color_contours_bar, fill= color_fill_bar_)+
  geom_text(stat='count', aes(x = EVALUACION_DOCENTE, label = ..count..), vjust = -1, color="black")+
  scale_y_continuous(limits = c(0,350))+
  labs(
    title="Distribución de Evaluación Docente",
    y="Frecuencia",
    x="Evaluación Docente",
    caption = "Elaboración Propia"
  )+
  theme_minimal()


ggplot(BBDD_proyecto_sin_ceros, aes(EVALUACION_DOCENTE, PROMEDIO_DIAS_LM)) +
  geom_boxplot(aes(fill=EVALUACION_DOCENTE))+
  xlab("Evaluación Docente")+
  ylab("Promedio Días LM")+
  labs(title = "Distribución de Evaluación Docente",
       caption = "Elaboración Propia")  +
  labs(fill = "Evaluación Docente") +  
  theme_minimal() + 
  theme(legend.position="none")+
  scale_fill_brewer(palette = "Set2")
```

```{r, message=FALSE, warning=FALSE, echo = FALSE, fig.align="center"}

ggplot(data=BBDD_proyecto_sin_ceros, aes(x=TRAMO_DOCENTE))+
  geom_bar(color = color_contours_bar, fill = color_fill_bar)+
  geom_text(stat='count', aes(x = TRAMO_DOCENTE, label = ..count..), vjust = -1, color="black")+
  scale_y_continuous(limits = c(0,200))+
  labs(
    title="Distribución de la variable Tramo Docente",
    y="Frecuencia",
    x="Tramo Docente",
    caption = "Elaboración Propia"
  )+
  theme_minimal()
```

### Correlación

```{r, message=FALSE, warning=FALSE, echo = FALSE,fig.align="center"}
head(BBDD_proyecto_sin_ceros)
df_num<-BBDD_proyecto_sin_ceros[,c(8,10,12,22)]   # se seleccionan las columnas continuas
correlacion<-round(cor(df_num), 1)
chart.Correlation(df_num, histogram = T, pch = 19)
```


Al analizar las correlaciones entre las variables predictoras continuas y el número promedio de dias con licencia se puede apreciar que la mayor correlación la presenta la variable edad con un coeficiente de 0.15 lo que sugiere posible efecto explicativo, seguido por la renta promedio con una correlación de 0.043, mientras que la jornada presente una correlación menor y negativa de -0.063.

```{r, message=FALSE, warning=FALSE, echo = FALSE,fig.align="center"}

ggplot(BBDD_proyecto_sin_ceros, aes(SEXO, PROMEDIO_DIAS_LM)) +
  geom_boxplot(aes(fill=SEXO))+
  xlab("SEXO")+
  ylab("Días Promedio")+
  scale_y_continuous(labels = comma)+
  labs(title = "Distribución por Días Promedio",
       caption = "Elaboración Propia")  +
  labs(fill = "Sexo") +  
  theme_minimal()+
  theme(legend.position="none")+
  scale_fill_brewer(palette = "Set2")

```


En este caso, los boxplot no sugieren un efecto del sexo sobre la distribución del numero de días con licencia promedio, dado que ambos soportes y estadísticas de posición son similares.


```{r, message=FALSE, warning=FALSE, echo = FALSE,fig.align="center"}
ggplot(BBDD_proyecto_sin_ceros, aes(ESTADO_CIVIL, PROMEDIO_DIAS_LM)) +
  geom_boxplot(aes(fill=ESTADO_CIVIL))+
  xlab("Estado Civil")+
  ylab("Promedio Días LM")+
  labs(title = "Distribución Estado Civil por Días Promedios",
       caption = "Elaboración Propia")  +
  labs(fill = "Estado Civil") +  
  theme_minimal() + 
  theme(legend.position="none")+
  scale_fill_brewer(palette = "Set2")

```

De acuerdo al gráfico los datos sugieren que el nivel "Divorciado" podría tener un efecto en el número promedio de días con licencia, dado que su soporte es levemente superior al de los demás niveles.

```{r, message=FALSE, warning=FALSE, echo = FALSE,fig.align="center"}
ggplot(BBDD_proyecto_sin_ceros, aes(SISTEMA_SALUD, PROMEDIO_DIAS_LM)) +
  geom_boxplot(aes(fill=SISTEMA_SALUD))+
  xlab("Sistema de Salud")+
  ylab("Promedio Días LM")+
  labs(title = "Distribución Sistema de Salud por Días Promedios",
       caption = "Elaboración Propia")  +
  labs(fill = "Sistema de Salud") +  
  theme_minimal() + 
  theme(legend.position="none")+
  scale_fill_brewer(palette = "Set2")

```

Para el caso de los sistemas de salud, no se observan diferencias importantes en los soportes ni en las estadísticas de posición del número promedio de días con licencia, es decir, el sistema de salud podría no tener un efecto significativo. 

```{r, message=FALSE, warning=FALSE, echo = FALSE,fig.align="center"}
ggplot(BBDD_proyecto_sin_ceros, aes(NIVEL, PROMEDIO_DIAS_LM)) +
  geom_boxplot(aes(fill=NIVEL))+
  xlab("Nivel Educacional")+
  ylab("Promedio Días LM")+
  labs(title = "Distribución Nivel Educacional por Días Promedios",
       caption = "Elaboración Propia")  +
  labs(fill = "Nivel") +   
  theme_minimal() + 
  theme(legend.position="none")+
  scale_fill_brewer(palette = "Set2")
```

Al observar la distribución del número promedio de días con licencia por nivel educacional no se observan grandes diferencias, lo que sugiere que este factor no presenta un grado de asociación significativo.

```{r, message=FALSE, warning=FALSE, echo = FALSE,fig.align="center"}
ggplot(BBDD_proyecto_sin_ceros, aes(CALIDAD_DESEMPEÑO, PROMEDIO_DIAS_LM)) +
  geom_boxplot(aes(fill=CALIDAD_DESEMPEÑO))+
  xlab("Calidad Desempeño")+
  ylab("Promedio Días LM")+
  labs(title = "Distribución Calidad Desempeño por Días Promedios",
       caption = "Elaboración Propia")  +
  theme_minimal() + 
  theme(legend.position="none")+
  scale_fill_brewer(palette = "Set2")
```

En este caso, el ser docente titular presenta un soporte levemente mayor que aquel docente con modalidad contrata, lo que puede sugerir un grado de asociación de este factor con el número promedio de días con licencia.

```{r, message=FALSE, warning=FALSE, echo = FALSE,fig.align="center"}

ggplot(BBDD_proyecto_sin_ceros, aes(ESTAMENTO, PROMEDIO_DIAS_LM)) +
  geom_boxplot(aes(fill=ESTAMENTO))+
  xlab("Estamento")+
  ylab("Promedio Días LM")+
  labs(title = "Distribución Estamento por Días Promedios",
       caption = "Elaboración Propia")  +
  theme_minimal() + 
  theme(legend.position="none")+
  scale_fill_brewer(palette = "Set2")
```

Analizando el factor "Estamento" se puede notar que aquel docente que sólo presneta estamento de docente tiene mayor soporte que aquel que tiene estamento de directivo, lo que sugiere algún grado de asociación de este factor con el número promedio de días de licencias. 

```{r, message=FALSE, warning=FALSE, echo = FALSE,fig.align="center"}

ggplot(data=BBDD_proyecto_sin_ceros, aes(x=TRAMO_DOCENTE, y=PROMEDIO_DIAS_LM, 
                                         fill = TRAMO_DOCENTE))+
  geom_boxplot() +
  labs(
    title="Distribución de los días promedio según la Tramo Docente",
    caption = "Elab. propia: BBDD Lic. Médicas 2022",
    y="Cantidad de Días promedios",
    x="Tramo Docente"
  )+
  theme_minimal()+
  theme(text = element_text(size=7))+
  theme(axis.title.x = element_text(vjust=-0.5, size=rel(1.5))) +
  theme(axis.title.y = element_text(vjust=1.5, size=rel(1.5))) +
  theme(plot.title = element_text(size = rel(2)))+
  scale_fill_brewer(palette = "Set2")+
  theme(legend.position="none")
```

En este caso los boxplot de los días promedio de licencias analizados por los niveles del tramo docente muestran cambios en sus soportes lo que puede sugerir algún asociación de este factor.

```{r, message=FALSE, warning=FALSE, echo = FALSE,fig.align="center"}
ggplot(BBDD_proyecto_sin_ceros, aes(EVALUACION_DOCENTE, PROMEDIO_DIAS_LM)) +
  geom_boxplot(aes(fill=EVALUACION_DOCENTE))+
  xlab("Evaluación Docente")+
  ylab("Promedio Días LM")+
  labs(title = "Distribución Evaluación Docente por Días Promedios",
       caption = "Elaboración Propia")  +
  theme_minimal() + 
  theme(legend.position="none")+
  scale_fill_brewer(palette = "Set2")

```
De acuerdo al gráfico se aprecia una distribución de valores centrales diferente en el nivel "insatisfactorio" del factor "Evaluación docente", mientras que el resto de los niveles presentan soportes y distribuciones centrales similares, esto sugiere que se podría crear una variable dummy que tome valor uno cuando la evaluación docente es insatisfactorio o cero en otro caso, pero se tendría que evaluar si produce los mismos asociacións sobre el modelo que se proponga. 

```{r, message=FALSE, warning=FALSE, echo = FALSE,fig.align="center"}
ggplot(BBDD_proyecto_sin_ceros, aes(TRASLADO_COMUNA, PROMEDIO_DIAS_LM)) +
  geom_boxplot(aes(fill=TRASLADO_COMUNA))+
  xlab("Traslado Comuna")+
  ylab("Promedio Días LM")+
  labs(title = "Distribución Traslado Comuna por Días Promedios",
       caption = "Elaboración Propia")  +
  theme_minimal() + 
  theme(legend.position="none")+
  scale_fill_brewer(palette = "Set2")


```

Respecto a la distribución del número de días con licencia de acuerdo al traslado, los soportes y distribuciones son similares, por lo cual no se sugiere algun asociación de este factor sobre la variable respuesta (número de días promedio con licencias)


## Selección Formal de Modelo

### Forward

Para la selección del modelo forward se utilizo una significancia del 5% en cada uno de los test de hipótesis realizados

```{r fig.align="center", warning=FALSE, message=FALSE, out.width="90%", out.height="99%"}
modelo0 = lm(PROMEDIO_DIAS_LM ~ 1, data = BBDD_proyecto_sin_ceros)
add1(modelo0, ~ .  + SEXO + ESTADO_CIVIL + EDAD + RENTA_PROMEDIO +
       SISTEMA_SALUD + JORNADA + NIVEL + CALIDAD_DESEMPEÑO +
       ESTAMENTO + EVALUACION_DOCENTE + TRAMO_DOCENTE + TRASLADO_COMUNA,
     test="F") 
```

Para decidir la entrada del segundo predictor, se debe evaluar todos los modelos que ya contienen al promedio de días de licencias medicas, a lo que se agrega cada uno de los predictores restantes por separado.

De acuerdo al caso anterior, el menor valor-p corresponde al modelo PROMEDIO_DIAS_LM ~ EVALUACION_DOCENTE

```{r fig.align="center", warning=FALSE, message=FALSE, out.width="90%", out.height="99%", echo = FALSE, include =FALSE}

modelo0 = lm(PROMEDIO_DIAS_LM ~ EVALUACION_DOCENTE, data = BBDD_proyecto_sin_ceros)
add1(modelo0, ~ .  + SEXO + ESTADO_CIVIL + EDAD + RENTA_PROMEDIO +
       SISTEMA_SALUD + JORNADA + NIVEL + CALIDAD_DESEMPEÑO +
       ESTAMENTO + EVALUACION_DOCENTE + TRAMO_DOCENTE + TRASLADO_COMUNA,
     test="F") 


modelo0 = lm(PROMEDIO_DIAS_LM ~ EVALUACION_DOCENTE + CALIDAD_DESEMPEÑO, 
             data = BBDD_proyecto_sin_ceros)
add1(modelo0, ~ .  + SEXO + ESTADO_CIVIL + EDAD + RENTA_PROMEDIO +
       SISTEMA_SALUD + JORNADA + NIVEL + CALIDAD_DESEMPEÑO +
       ESTAMENTO + EVALUACION_DOCENTE + TRAMO_DOCENTE + TRASLADO_COMUNA,
     test="F") 


modelo0 = lm(PROMEDIO_DIAS_LM ~ EVALUACION_DOCENTE + CALIDAD_DESEMPEÑO +NIVEL, 
             data = BBDD_proyecto_sin_ceros)
add1(modelo0, ~ .  + SEXO + ESTADO_CIVIL + EDAD + RENTA_PROMEDIO +
       SISTEMA_SALUD + JORNADA + NIVEL + CALIDAD_DESEMPEÑO +
       ESTAMENTO + EVALUACION_DOCENTE + TRAMO_DOCENTE + TRASLADO_COMUNA,
     test="F") 


modelo0 = lm(PROMEDIO_DIAS_LM ~ EVALUACION_DOCENTE + CALIDAD_DESEMPEÑO +NIVEL + EDAD, 
             data = BBDD_proyecto_sin_ceros)
add1(modelo0, ~ .  + SEXO + ESTADO_CIVIL + EDAD + RENTA_PROMEDIO +
       SISTEMA_SALUD + JORNADA + NIVEL + CALIDAD_DESEMPEÑO +
       ESTAMENTO + EVALUACION_DOCENTE + TRAMO_DOCENTE + TRASLADO_COMUNA,
     test="F") 
     
summary(modelo0)

```


|Coeficientes | Estimación | Std. Error | t value | Pr(>t)|
|:---------|:---------:| :---------:|:---------:|:---------:|
|Intercepto | 7.59163 | 1.49024 |5.094|4.6e-07 |
|EVALUACION_DOCENTEDESTACADO|-2.69256|1.55890|-1.727|0.08460 |
|EVALUACION_DOCENTEBASICO|-2.08287 |1.13656|-1.833|0.06732 |
|EVALUACION_DOCENTEINSATISFACTORIO|7.87294 |1.52249|5.171|3.1e-07|
|EVALUACION_DOCENTECOMPETENTE|-1.91725 |1.12365|-1.706|0.08844|
|CALIDAD_DESEMPEÑOTITULAR|2.65846|0.72190|3.683|0.00025 |
|NIVELMEDIA|-1.84583|0.63467|-2.908|0.00376 |
|EDAD|0.06085|0.02425|2.509|0.01233|



# Categoriza la edad 
```{r, message=FALSE, warning=FALSE,fig.align="center", echo=FALSE}
BBDD_proyecto_sin_ceros<-mutate(BBDD_proyecto_sin_ceros, TRAMO_EDAD = cut(BBDD_proyecto_sin_ceros$EDAD, breaks = 2, right = FALSE))
```

# Metodología Forward
##############################################

# Primera variable que entra al modelo

```{r, message=FALSE, warning=FALSE,fig.align="center", echo=FALSE}
forward<-lm(data=BBDD_proyecto_sin_ceros, PROMEDIO_DIAS_LM ~ 1)
add1(forward, ~ SEXO+ ESTADO_CIVIL + TRAMO_EDAD + RENTA_PROMEDIO + JORNADA + NIVEL + TIPO_ESTABLECIMIENTO + CALIDAD_DESEMPEÑO +
       TRAMO_DOCENTE + INSATISFACTORIO + TRASLADO_COMUNA, data=BBDD_proyecto_sin_ceros, test="F")
```

# Segunda variable que entra al modelo

```{r, message=FALSE, warning=FALSE,fig.align="center", echo=FALSE}
forward<-lm(data=BBDD_proyecto_sin_ceros, PROMEDIO_DIAS_LM ~ INSATISFACTORIO)

add1(forward, ~ SEXO+ ESTADO_CIVIL + TRAMO_EDAD + RENTA_PROMEDIO + JORNADA + NIVEL + TIPO_ESTABLECIMIENTO + CALIDAD_DESEMPEÑO +
       TRAMO_DOCENTE + INSATISFACTORIO + TRASLADO_COMUNA, data=BBDD_proyecto_sin_ceros, test="F")
```

# Tercera variable que entra al modelo

```{r, message=FALSE, warning=FALSE,fig.align="center", echo=FALSE}
forward<-lm(data=BBDD_proyecto_sin_ceros, PROMEDIO_DIAS_LM ~ INSATISFACTORIO + CALIDAD_DESEMPEÑO)
add1(forward, ~ SEXO+ ESTADO_CIVIL + TRAMO_EDAD + RENTA_PROMEDIO + JORNADA + NIVEL + TIPO_ESTABLECIMIENTO + CALIDAD_DESEMPEÑO +
       TRAMO_DOCENTE + INSATISFACTORIO + TRASLADO_COMUNA, data=BBDD_proyecto_sin_ceros, test="F")
```

# Cuarta variable que entra al modelo
```{r, message=FALSE, warning=FALSE,fig.align="center", echo=FALSE}
forward<-lm(data=BBDD_proyecto_sin_ceros, PROMEDIO_DIAS_LM ~ INSATISFACTORIO + CALIDAD_DESEMPEÑO + TRAMO_EDAD)
add1(forward, ~ SEXO+ ESTADO_CIVIL + TRAMO_EDAD + RENTA_PROMEDIO + JORNADA + NIVEL + TIPO_ESTABLECIMIENTO + CALIDAD_DESEMPEÑO +
       TRAMO_DOCENTE + INSATISFACTORIO + TRASLADO_COMUNA, data=BBDD_proyecto_sin_ceros, test="F")
```
# Finalmente

```{r, message=FALSE, warning=FALSE,fig.align="center", echo=FALSE}
forward<-lm(data=BBDD_proyecto_sin_ceros, PROMEDIO_DIAS_LM ~ INSATISFACTORIO + CALIDAD_DESEMPEÑO + TRAMO_EDAD + NIVEL)
add1(forward, ~ SEXO+ ESTADO_CIVIL + TRAMO_EDAD + RENTA_PROMEDIO + JORNADA + NIVEL + TIPO_ESTABLECIMIENTO + CALIDAD_DESEMPEÑO +
       TRAMO_DOCENTE + INSATISFACTORIO + TRASLADO_COMUNA, data=BBDD_proyecto_sin_ceros, test="F")
```

# Modelo resultante por forward

```{r, message=FALSE, warning=FALSE,fig.align="center", echo=FALSE}
modelo_forward<-lm(data=BBDD_proyecto_sin_ceros, PROMEDIO_DIAS_LM ~ INSATISFACTORIO + CALIDAD_DESEMPEÑO + TRAMO_EDAD + NIVEL)
summary(modelo_forward)
```
# Metodología Backward

# Primera variable que sale al modelo

```{r, message=FALSE, warning=FALSE,fig.align="center", echo=FALSE}
backward<-lm(data=BBDD_proyecto_sin_ceros, PROMEDIO_DIAS_LM ~ SEXO+ ESTADO_CIVIL + TRAMO_EDAD + RENTA_PROMEDIO + JORNADA + NIVEL +
               TIPO_ESTABLECIMIENTO + CALIDAD_DESEMPEÑO + TRAMO_DOCENTE + INSATISFACTORIO + TRASLADO_COMUNA)
drop1(backward, ~ SEXO+ ESTADO_CIVIL + TRAMO_EDAD + RENTA_PROMEDIO + JORNADA + NIVEL + TIPO_ESTABLECIMIENTO + CALIDAD_DESEMPEÑO +
        TRAMO_DOCENTE + INSATISFACTORIO + TRASLADO_COMUNA, data=BBDD_proyecto_sin_ceros,  test = 'F')
```


# Segunda variable que sale al modelo

```{r, message=FALSE, warning=FALSE,fig.align="center", echo=FALSE}
backward <- update(backward, ~ . - RENTA_PROMEDIO, data=BBDD_proyecto_sin_ceros)
drop1(backward, ~ SEXO + ESTADO_CIVIL + TRAMO_EDAD + JORNADA + NIVEL + TIPO_ESTABLECIMIENTO + CALIDAD_DESEMPEÑO +
        TRAMO_DOCENTE + INSATISFACTORIO + TRASLADO_COMUNA, data=BBDD_proyecto_sin_ceros,  test = 'F')
```

# Tercera variable que sale al modelo

```{r, message=FALSE, warning=FALSE,fig.align="center", echo=FALSE}
backward <- update(backward, ~ . - RENTA_PROMEDIO - JORNADA, data=BBDD_proyecto_sin_ceros)
drop1(backward, ~ SEXO + ESTADO_CIVIL + TRAMO_EDAD + NIVEL + TIPO_ESTABLECIMIENTO + CALIDAD_DESEMPEÑO +
        TRAMO_DOCENTE + INSATISFACTORIO + TRASLADO_COMUNA, data=BBDD_proyecto_sin_ceros,  test = 'F')
```

# Cuarta variable que sale al modelo

```{r, message=FALSE, warning=FALSE,fig.align="center", echo=FALSE}
backward <- update(backward, ~ . - RENTA_PROMEDIO - JORNADA - SEXO, data=BBDD_proyecto_sin_ceros)
drop1(backward, ~ ESTADO_CIVIL + TRAMO_EDAD + NIVEL + TIPO_ESTABLECIMIENTO + CALIDAD_DESEMPEÑO +
        TRAMO_DOCENTE + INSATISFACTORIO + TRASLADO_COMUNA, data=BBDD_proyecto_sin_ceros,  test = 'F')
```

# Quinta variable que sale al modelo

```{r, message=FALSE, warning=FALSE,fig.align="center", echo=FALSE}
backward <- update(backward, ~ . - RENTA_PROMEDIO - JORNADA - SEXO - TRASLADO_COMUNA, data=BBDD_proyecto_sin_ceros)
drop1(backward, ~ ESTADO_CIVIL + TRAMO_EDAD + NIVEL + TIPO_ESTABLECIMIENTO + CALIDAD_DESEMPEÑO +
        TRAMO_DOCENTE + INSATISFACTORIO, data=BBDD_proyecto_sin_ceros,  test = 'F')
```

# Sexta variable que sale al modelo

```{r, message=FALSE, warning=FALSE,fig.align="center", echo=FALSE}
backward <- update(backward, ~ . - RENTA_PROMEDIO - JORNADA - SEXO - TRASLADO_COMUNA - ESTADO_CIVIL, data=BBDD_proyecto_sin_ceros)
drop1(backward, ~ TRAMO_EDAD + NIVEL + TIPO_ESTABLECIMIENTO + CALIDAD_DESEMPEÑO + TRAMO_DOCENTE + INSATISFACTORIO, data=BBDD_proyecto_sin_ceros,  test = 'F')
```

# Septima variable que sale al modelo

```{r, message=FALSE, warning=FALSE,fig.align="center", echo=FALSE}
backward <- update(backward, ~ . - RENTA_PROMEDIO - JORNADA - SEXO - TRASLADO_COMUNA - ESTADO_CIVIL - TIPO_ESTABLECIMIENTO, data=BBDD_proyecto_sin_ceros)
drop1(backward, ~ TRAMO_EDAD + NIVEL + CALIDAD_DESEMPEÑO + TRAMO_DOCENTE + INSATISFACTORIO, data=BBDD_proyecto_sin_ceros,  test = 'F')
```

# Octava variable que sale al modelo

```{r, message=FALSE, warning=FALSE,fig.align="center", echo=FALSE}
backward <- update(backward, ~ . - RENTA_PROMEDIO - JORNADA - SEXO - TRASLADO_COMUNA - ESTADO_CIVIL - TIPO_ESTABLECIMIENTO - TRAMO_DOCENTE, data=BBDD_proyecto_sin_ceros)
drop1(backward, ~ TRAMO_EDAD + NIVEL + CALIDAD_DESEMPEÑO + INSATISFACTORIO, data=BBDD_proyecto_sin_ceros,  test = 'F')
```

# Modelo resultante por backward

```{r, message=FALSE, warning=FALSE,fig.align="center", echo=FALSE}
modelo_backward<-lm(data=BBDD_proyecto_sin_ceros, PROMEDIO_DIAS_LM ~ TRAMO_EDAD + NIVEL + CALIDAD_DESEMPEÑO + INSATISFACTORIO)
summary(modelo_backward)
```


# Anexos 

## Anexo Tablas

## Anexo Gráficos

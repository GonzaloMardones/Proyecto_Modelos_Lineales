---
title: "Proyecto Modelos Lineales"
author: "Oscar Gamboa, Gonzalo Mardones, Nicolas Montecinos"
date: "`r Sys.Date()`"
output: pdf_document
header-includes: 
  - \usepackage{tikz}
  - \usepackage{pgfplots}
  - \usepackage{amsmath}
  - \usepackage{dutchcal}
---

## Introducción
 - bla bla

### Planteamiento del Problema
¿Cuáles son los hechos o fenómenos?; ¿Qué dicen los datos?

- Fenomeno: Licencias medicas en funcionarios de educación en Huasco - 2022 han llegado con mucha frecuencia...

### Justificación del Problema
 Las razones que conducen a investigar el fenómeno.
  
  - En funcion del impacto de las licencias medicas.    - caracterizacion de la licencia medica (numeros promedios de días )
  
  
###  Estado del Arte
¿Qué se ha dicho del tema en cuestión?; ¿Cómo lo han
investigado?; ¿Qué tipo de metodología utilizan?

BUSCAR UNA REFERENCIA A NIVEL NACIONAL PARA DECLARAR EL IMPACTO (DOCENTES Y MEDICOS)
METODOLOGIA DE CONTEO (DESCRIPTIVO) 


### Objetivo General y Objetivo Especifico

¿Para qué y cómo abordar la investigación?

  - Obj General: 
  se busca caracterizar la catnidad de dias promedios de LM de los docentes contratados bajo la administración del servicio de ed. publica de la provincia de Huasco, con info actualizada ENE-2022 a OCT-2022 con el fin poder entregar mayores antecedentes a la hora de tomar decisiones a nivel provincial 
  
  - Obj Especificos:
    - Obtener, recopilar y extraer las caracteristicas más importantes que aporten al estudio de la investigación 

    - Descripción y asociación de variables predictoras con respecto a la cantidad promedio de días.
    
    - validación la base de datos y modificar su estructura para los fines de este estudio
    
    <!-- -Método y selección de variables -->


### Plateamiento de la hipótesis en el estudio
¿Qué es lo que quiero problematizar o comprobar?

  <!-- - Se desea validar que (definición de hipotesis) -->
  
  - Se quiere determinar si la evaluación docente esta indirectametne relacionada con el promedio de días tomados por licencias medicas de los mismos docentes 
  
  
  

## Generación de unidades de información

### Diseño de estrategias metodológicas
<!-- : ¿Qué metodologías utilizaré?; -->

¿Cómo voy a alcanzar los objetivos que he construido?


Debido a lo que se quiere explicar, se plantea
metodologia a traves de regresiones lineales debido a que se quiere explocar ....


## Procesamiento de las unidades de información

Análisis de datos: ¿Qué dicen los datos?

La base de datos esta compuesta por $1.109$ observaciones y $15$ columnas detalladas a continuación:

### Descripción de los datos 

\begin{center}
    \begin{tabular}{|c|}
        \hline
        \textbf{Base de datos de Licencias Médicas}\\
        \begin{tabular}{|p{5cm}|p{11cm}|}
            \hline
             \textbf{Variable} & \textbf{Descripción}\\
             \hline
             SEXO & [FACTOR] ...\\
            \hline
             ESTADO\_CIVIL & [FACTOR] ...\\
            \hline
             EDAD & [DOUBLE] ...\\
            \hline
             RENTA\_PROMEDIO & [DOUBLE] ...\\
            \hline
             SISTEMA\_SALUD & [FACTOR] ...\\
            \hline 
             JORNADA & [DOUBLE] ...\\
            \hline             
             NIVEL & [FACTOR] ...\\
            \hline                         
             TIPO\_ESTABLECIMIENTO & [FACTOR] ...\\
            \hline                                    
             CALIDAD\_DESEMPEÑO & [FACTOR] profe jefe o no \\
            \hline  
             TRAMO\_DOCENTE & [FACTOR] ...\\
            \hline                          
             EVALUACION\_DOCENTE & [FACTOR] ...\\
            \hline  
             PROMEDIO\_DIAS\_LM & [DOUBLE] ...\\
            \hline                          
             TRASLADO\_COMUNA & [DOUBLE] ...\\
            \hline                                      
        \end{tabular}\\
        \\
        \hline
    \end{tabular}
\end{center}


Detalle de ETL de los datos

```{r fig.align="center", warning=FALSE, message=FALSE, out.width="70%", include = FALSE}
library(readxl)
library(tidyverse)

setwd("~/Desktop/MAGISTER/modelos_lineales/")
BBDD_proyecto <- read_excel("BBDD_FINAL_Mod_Lin.xlsx")
```

 -NOTA:  Agregar el histograma incluyendo los casos de profesionales sin licencias médicas


```{r fig.align="center", warning=FALSE, message=FALSE, out.width="90%", out.height="99%"}
BBDD_proyecto <- BBDD_proyecto %>% mutate_at(c("SEXO","ESTADO_CIVIL",
                              "SISTEMA_SALUD","NIVEL",
                              "TIPO_ESTABLECIMIENTO",
                              "CALIDAD_DESEMPEÑO",
                              "COMUNA_ESTABLECIMIENTO",
                              "ESTAMENTO","TRAMO_DOCENTE"),factor)

BBDD_proyecto$EVALUACION_DOCENTE <- factor(BBDD_proyecto$EVALUACION_DOCENTE,
                                           levels = c("SIN EVALUACIÓN",
                                                      "DESTACADO",
                                                      "BASICO",
                                                      "INSATISFACTORIO",
                                                      "COMPETENTE"))

BBDD_proyecto_sin_ceros <- BBDD_proyecto %>% filter(PROMEDIO_DIAS_LM != 0)
```

```{r fig.align="center", warning=FALSE, message=FALSE, out.width="80%", out.height="80%", echo=FALSE}
ggplot(BBDD_proyecto_sin_ceros, aes(x = PROMEDIO_DIAS_LM)) +
  geom_histogram(aes(y =..density..), colour = "black", fill = "white") +
  geom_density(alpha = 0.6 , fill = "#FF6666", lwd = 1,colour = 2)+
  geom_vline(aes(xintercept = mean(PROMEDIO_DIAS_LM)),
             color = "blue", linetype = "dashed", size = 1)+
  theme_minimal()
```


Boxplot de días promedios de licencias medicas

```{r fig.align="center", warning=FALSE, message=FALSE, out.width="80%", out.height="80%", echo=FALSE}
ggplot(BBDD_proyecto_sin_ceros, aes(x = PROMEDIO_DIAS_LM))+
  stat_boxplot(geom = "errorbar",width = 0.15) +
  geom_boxplot(fill="#FF6666")+
  theme_minimal()
```

Explorar las variables más importantes





## Selección Formal de Modelo

Para la selección del modelo forward se utilizo una significancia del 5% en cada uno de los test de hipótesis realizados

```{r fig.align="center", warning=FALSE, message=FALSE, out.width="90%", out.height="99%"}
modelo0 = lm(PROMEDIO_DIAS_LM ~ 1, data = BBDD_proyecto_sin_ceros)
add1(modelo0, ~ .  + SEXO + ESTADO_CIVIL + EDAD + RENTA_PROMEDIO +
       SISTEMA_SALUD + JORNADA + NIVEL + CALIDAD_DESEMPEÑO +
       ESTAMENTO + EVALUACION_DOCENTE + TRAMO_DOCENTE + TRASLADO_COMUNA,
     test="F") 
```

Para decidir la entrada del segundo predictor, se debe evaluar todos los modelos que ya contienen al promedio de días de licencias medicas, a lo que se agrega cada uno de los predictores restantes por separado.

De acuerdo al caso anterior, el menor valor-p corresponde al modelo PROMEDIO_DIAS_LM ~ EVALUACION_DOCENTE

```{r fig.align="center", warning=FALSE, message=FALSE, out.width="90%", out.height="99%"}
modelo0 = lm(PROMEDIO_DIAS_LM ~ EVALUACION_DOCENTE, data = BBDD_proyecto_sin_ceros)
add1(modelo0, ~ .  + SEXO + ESTADO_CIVIL + EDAD + RENTA_PROMEDIO +
       SISTEMA_SALUD + JORNADA + NIVEL + CALIDAD_DESEMPEÑO +
       ESTAMENTO + EVALUACION_DOCENTE + TRAMO_DOCENTE + TRASLADO_COMUNA,
     test="F") 


modelo0 = lm(PROMEDIO_DIAS_LM ~ EVALUACION_DOCENTE + CALIDAD_DESEMPEÑO, 
             data = BBDD_proyecto_sin_ceros)
add1(modelo0, ~ .  + SEXO + ESTADO_CIVIL + EDAD + RENTA_PROMEDIO +
       SISTEMA_SALUD + JORNADA + NIVEL + CALIDAD_DESEMPEÑO +
       ESTAMENTO + EVALUACION_DOCENTE + TRAMO_DOCENTE + TRASLADO_COMUNA,
     test="F") 


modelo0 = lm(PROMEDIO_DIAS_LM ~ EVALUACION_DOCENTE + CALIDAD_DESEMPEÑO +NIVEL, 
             data = BBDD_proyecto_sin_ceros)
add1(modelo0, ~ .  + SEXO + ESTADO_CIVIL + EDAD + RENTA_PROMEDIO +
       SISTEMA_SALUD + JORNADA + NIVEL + CALIDAD_DESEMPEÑO +
       ESTAMENTO + EVALUACION_DOCENTE + TRAMO_DOCENTE + TRASLADO_COMUNA,
     test="F") 


modelo0 = lm(PROMEDIO_DIAS_LM ~ EVALUACION_DOCENTE + CALIDAD_DESEMPEÑO +NIVEL + EDAD, 
             data = BBDD_proyecto_sin_ceros)
add1(modelo0, ~ .  + SEXO + ESTADO_CIVIL + EDAD + RENTA_PROMEDIO +
       SISTEMA_SALUD + JORNADA + NIVEL + CALIDAD_DESEMPEÑO +
       ESTAMENTO + EVALUACION_DOCENTE + TRAMO_DOCENTE + TRASLADO_COMUNA,
     test="F") 
     
summary(modelo0)

```

|Coeficientes | Estimación | Std. Error | t value | Pr(>t)|
|:---------|:---------:| :---------:|:---------:|:---------:|
|Intercepto | 4.372e+05 | 2.451e+04 |17.838|< 2e-16 ***|
|STATEFL|-4.690e+05|17210000|-27.251|< 2e-16 ***|
|STATEMI|-3.483e+05 |37180000|-9.369|1.18e-15 ***|
|STATENY|-322900000|29740000|-10.857|< 2e-16 ***|
|STATETX|-298700000|8024000|-37.225|< 2e-16 ***|
|STATEUT|-630500000|35070000|-17.979|< 2e-16 ***|
|YEAR1968|2536000|13280000|0.191|0.848955 |
|YEAR1969|18270000|13270000|1.377|0.171444|
|YEAR1970|22620000|13280000|1.704|0.091252|
|YEAR1971|40560000|13270000|3.056|0.002820 ** |
|YEAR1972|43720000|13280000|3.293|0.001336 ** |
|YEAR1973|41320000|13330000|3.099|0.002469 ** |
|YEAR1974|31800000|13310000|2.389|0.018604 * |
|YEAR1975|35890000|13270000|2.704|0.007942 ** |
|YEAR1976|30860000|13310000|2.318|0.022339 * |
|YEAR1977|18760000|13280000|1.413|0.160613|
|YEAR1978|18470000|13390000|1.379|0.170612 |
|YEAR1979|41650000|13330000|3.124|0.002283 **| 
|YEAR1980|25830000|13270000|1.946|0.054244|
|YEAR1981|19140000|13360000|1.433|0.154732|
|YEAR1982|20130000|13280000|1.516|0.132493|
|YEAR1983|11590000|13280000|0.872|0.384912|
|YEAR1984|9338000|13270000|0.704|0.483233|
|YEAR1985|11460000|13290000|0.862|0.390357|
|YEAR1986|12570000|13570000|0.927|0.356180|
|YEAR1987|14450000|13480000|1.072|0.286148|
|YEAR1988|15780000|13280000|1.188|0.237427|
|YEAR1989|22250000|13280000|1.676|0.096632|
|HDD|33340|8513|3.916|0.000157 ***|
